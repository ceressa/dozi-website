<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.google.com https://www.gstatic.com; style-src 'self' 'unsafe-inline'; frame-src https://www.google.com; connect-src 'self' https://www.google.com https://europe-west3-dozi-cd7cc.cloudfunctions.net;">
    
    <title>KVKK BaÅŸvuru Formu | Dozi</title>
    <meta name="description" content="KVKK kapsamÄ±nda kiÅŸisel veri talepleriniz iÃ§in baÅŸvuru formu">
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="icon" type="image/png" href="../dozi_brand.png">
    
    <!-- reCAPTCHA v3 -->
    <script src="https://www.google.com/recaptcha/api.js?render=6Lcp60MsAAAAAFZ4qhzifUXH7YRmVfhFu2n36epX"></script>
    
    <style>
        :root {
            --dozi-turquoise: #40E0D0;
            --dozi-dark: #0f172a;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --bg-light: #f8fafc;
            --success: #10b981;
            --danger: #ef4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-light); color: var(--text-primary); line-height: 1.6; }
        
        .container { max-width: 700px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 1.5rem; }
        
        .header { text-align: center; margin-bottom: 2rem; }
        .header img { height: 48px; margin-bottom: 1rem; }
        .header h1 { font-size: 1.75rem; color: var(--dozi-dark); margin-bottom: 0.5rem; }
        .header p { color: var(--text-secondary); }
        
        .info-box { background: #e0f2fe; border-left: 4px solid #0284c7; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; }
        .info-box h3 { color: #075985; margin-bottom: 0.5rem; font-size: 1rem; }
        .info-box ul { margin: 0.5rem 0 0 1.5rem; color: #075985; }
        
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary); }
        .form-group label .required { color: var(--danger); }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--dozi-turquoise); }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-group small { display: block; margin-top: 0.25rem; color: var(--text-secondary); font-size: 0.875rem; }
        
        .request-types { display: grid; gap: 0.75rem; margin-bottom: 1.5rem; }
        .request-type { padding: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.3s; position: relative; }
        .request-type:hover { border-color: var(--dozi-turquoise); background: #f0fdfa; }
        .request-type input[type="checkbox"] { margin-right: 0.5rem; }
        .request-type.selected { border-color: var(--dozi-turquoise); background: #f0fdfa; }
        .request-type label { cursor: pointer; font-weight: 600; display: flex; align-items: center; }
        .request-type p { margin-top: 0.25rem; margin-left: 1.5rem; font-size: 0.875rem; color: var(--text-secondary); }
        
        .btn { display: block; width: 100%; padding: 1rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: var(--dozi-turquoise); color: white; }
        .btn-primary:hover:not(:disabled) { background: #2dd4bf; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(64, 224, 208, 0.3); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .success-message, .error-message { padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: none; }
        .success-message { background: #d1fae5; color: #065f46; border-left: 4px solid var(--success); }
        .error-message { background: #fee2e2; color: #991b1b; border-left: 4px solid var(--danger); }
        .success-message.show, .error-message.show { display: block; }
        
        /* Modal Popup */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 1000; animation: fadeIn 0.3s; }
        .modal-overlay.show { display: flex; }
        .modal-content { background: white; border-radius: 16px; padding: 2rem; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: slideUp 0.3s; }
        .modal-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
        .modal-icon { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .modal-icon.success { background: #d1fae5; color: #065f46; }
        .modal-icon.error { background: #fee2e2; color: #991b1b; }
        .modal-title { font-size: 1.5rem; font-weight: 700; margin: 0; }
        .modal-body { color: var(--text-secondary); line-height: 1.6; margin-bottom: 1.5rem; }
        .modal-body strong { color: var(--text-primary); display: block; margin-top: 0.5rem; }
        .modal-footer { display: flex; gap: 0.5rem; justify-content: flex-end; }
        .modal-btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .modal-btn-primary { background: var(--dozi-turquoise); color: white; }
        .modal-btn-primary:hover { background: #2dd4bf; }
        .modal-btn-secondary { background: #f1f5f9; color: var(--text-primary); }
        .modal-btn-secondary:hover { background: #e2e8f0; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .back-link { text-align: center; margin-top: 1.5rem; }
        .back-link a { color: var(--dozi-turquoise); text-decoration: none; font-weight: 500; }
        .back-link a:hover { text-decoration: underline; }
        
        .recaptcha-notice { font-size: 0.75rem; color: var(--text-secondary); text-align: center; margin-top: 1rem; }
        
        @media (max-width: 640px) {
            .container { margin: 1rem auto; }
            .card { padding: 1.5rem; }
            .header h1 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <img src="../dozi_brand.png" alt="Dozi">
                <h1>ğŸ“‹ KVKK BaÅŸvuru Formu</h1>
                <p>KiÅŸisel verilerinizle ilgili haklarÄ±nÄ±zÄ± kullanÄ±n</p>
            </div>
            
            <div class="info-box">
                <h3>ğŸ“Œ KVKK KapsamÄ±ndaki HaklarÄ±nÄ±z:</h3>
                <ul>
                    <li>KiÅŸisel verilerinizin iÅŸlenip iÅŸlenmediÄŸini Ã¶ÄŸrenme</li>
                    <li>Ä°ÅŸlenmiÅŸse bilgi talep etme</li>
                    <li>Ä°ÅŸlenme amacÄ±nÄ± ve amacÄ±na uygun kullanÄ±lÄ±p kullanÄ±lmadÄ±ÄŸÄ±nÄ± Ã¶ÄŸrenme</li>
                    <li>Yurt iÃ§inde/yurt dÄ±ÅŸÄ±nda aktarÄ±ldÄ±ÄŸÄ± 3. kiÅŸileri bilme</li>
                    <li>Eksik/yanlÄ±ÅŸ iÅŸlenmiÅŸse dÃ¼zeltilmesini isteme</li>
                    <li>Silinmesini/yok edilmesini isteme</li>
                    <li>DÃ¼zeltme/silme iÅŸlemlerinin 3. kiÅŸilere bildirilmesini isteme</li>
                    <li>Ä°ÅŸlenen verilerin mÃ¼nhasÄ±ran otomatik sistemler ile analiz edilmesi sonucu aleyhinize bir sonuÃ§ doÄŸmasÄ±na itiraz etme</li>
                    <li>Kanuna aykÄ±rÄ± iÅŸleme nedeniyle zarara uÄŸramanÄ±z halinde zararÄ±n giderilmesini talep etme</li>
                </ul>
            </div>
            
            <div id="successMessage" class="success-message"></div>
            <div id="errorMessage" class="error-message"></div>
            
            <form id="kvkkForm">
                <div class="form-group">
                    <label>Talep Tipi <span class="required">*</span></label>
                    <small style="display: block; margin-bottom: 0.5rem;">Birden fazla seÃ§ebilirsiniz</small>
                    <div class="request-types">
                        <div class="request-type" onclick="toggleCheckbox('access')">
                            <label for="access">
                                <input type="checkbox" id="access" name="requestType" value="access" onclick="event.stopPropagation()">
                                Veri EriÅŸim Talebi
                            </label>
                            <p>Hangi verilerinizin iÅŸlendiÄŸini Ã¶ÄŸrenin</p>
                        </div>
                        <div class="request-type" onclick="toggleCheckbox('correction')">
                            <label for="correction">
                                <input type="checkbox" id="correction" name="requestType" value="correction" onclick="event.stopPropagation()">
                                Veri DÃ¼zeltme Talebi
                            </label>
                            <p>YanlÄ±ÅŸ/eksik verilerin dÃ¼zeltilmesini isteyin</p>
                        </div>
                        <div class="request-type" onclick="toggleCheckbox('deletion')">
                            <label for="deletion">
                                <input type="checkbox" id="deletion" name="requestType" value="deletion" onclick="event.stopPropagation()">
                                Veri Silme Talebi
                            </label>
                            <p>Verilerinizin silinmesini/yok edilmesini isteyin</p>
                        </div>
                        <div class="request-type" onclick="toggleCheckbox('portability')">
                            <label for="portability">
                                <input type="checkbox" id="portability" name="requestType" value="portability" onclick="event.stopPropagation()">
                                Veri TaÅŸÄ±nabilirlik Talebi
                            </label>
                            <p>Verilerinizi yapÄ±landÄ±rÄ±lmÄ±ÅŸ formatta alÄ±n</p>
                        </div>
                        <div class="request-type" onclick="toggleCheckbox('objection')">
                            <label for="objection">
                                <input type="checkbox" id="objection" name="requestType" value="objection" onclick="event.stopPropagation()">
                                Ä°tiraz Talebi
                            </label>
                            <p>Otomatik iÅŸleme sonuÃ§larÄ±na itiraz edin</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>AdÄ±nÄ±z SoyadÄ±nÄ±z <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required maxlength="100">
                </div>
                
                <div class="form-group">
                    <label>Email Adresiniz <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required maxlength="100">
                    <small>YanÄ±t bu adrese gÃ¶nderilecek</small>
                </div>
                
                <div class="form-group">
                    <label>Telefon NumaranÄ±z (Opsiyonel)</label>
                    <input type="tel" id="phone" name="phone" maxlength="20" placeholder="+90 5XX XXX XX XX">
                </div>
                
                <div class="form-group">
                    <label>TC Kimlik No (Opsiyonel)</label>
                    <input type="text" id="identityDocument" name="identityDocument" maxlength="11" placeholder="Kimlik doÄŸrulama iÃ§in">
                    <small>GÃ¼venlik amacÄ±yla ÅŸifrelenmiÅŸ olarak saklanÄ±r</small>
                </div>
                
                <div class="form-group">
                    <label>KullanÄ±cÄ± ID (Opsiyonel)</label>
                    <input type="text" id="userId" name="userId" maxlength="50">
                    <small>Ayarlar > HakkÄ±nda > KullanÄ±cÄ± ID</small>
                </div>
                
                <div class="form-group">
                    <label>Talep DetaylarÄ± <span class="required">*</span></label>
                    <textarea id="details" name="details" required maxlength="1000" placeholder="Talebinizi detaylÄ± olarak aÃ§Ä±klayÄ±n..."></textarea>
                    <small>Talebinizi aÃ§Ä±k ve net bir ÅŸekilde belirtin</small>
                </div>
                
                <button type="submit" class="btn btn-primary" id="submitBtn">
                    BaÅŸvuruyu GÃ¶nder
                </button>
                
                <div class="recaptcha-notice">
                    ğŸ”’ Bu form Google reCAPTCHA v3 ile korunmaktadÄ±r.<br>
                    <a href="https://policies.google.com/privacy" target="_blank" style="color: var(--dozi-turquoise);">Gizlilik</a> ve 
                    <a href="https://policies.google.com/terms" target="_blank" style="color: var(--dozi-turquoise);">Hizmet ÅartlarÄ±</a> geÃ§erlidir.<br>
                    <small style="color: var(--text-secondary); margin-top: 5px; display: block;">TÃ¼m zaman damgalarÄ± TÃ¼rkiye Saati (GMT+3) ile gÃ¶sterilir</small>
                </div>
            </form>
            
            <div class="back-link">
                <a href="../privacy-policy.html">â† Gizlilik PolitikasÄ±</a>
            </div>
        </div>
    </div>
    
    <!-- Success/Error Modal -->
    <div id="modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div id="modalIcon" class="modal-icon"></div>
                <h2 id="modalTitle" class="modal-title"></h2>
            </div>
            <div id="modalBody" class="modal-body"></div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" onclick="closeModal()">Tamam</button>
            </div>
        </div>
    </div>
    
    <script>
        const form = document.getElementById('kvkkForm');
        const submitBtn = document.getElementById('submitBtn');
        const modal = document.getElementById('modal');
        const modalIcon = document.getElementById('modalIcon');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        
        // reCAPTCHA site key
        const RECAPTCHA_SITE_KEY = '6Lcp60MsAAAAAFZ4qhzifUXH7YRmVfhFu2n36epX';
        
        // Modal fonksiyonlarÄ±
        function showModal(type, title, body) {
            modalIcon.className = `modal-icon ${type}`;
            modalIcon.textContent = type === 'success' ? 'âœ“' : 'âœ•';
            modalTitle.textContent = title;
            modalBody.innerHTML = body;
            modal.classList.add('show');
        }
        
        function closeModal() {
            modal.classList.remove('show');
        }
        
        // Modal dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapat
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
        
        // Checkbox toggle fonksiyonu
        function toggleCheckbox(id) {
            const checkbox = document.getElementById(id);
            checkbox.checked = !checkbox.checked;
            updateRequestTypeStyles();
        }
        
        // SeÃ§ili talep tiplerinin stilini gÃ¼ncelle
        function updateRequestTypeStyles() {
            document.querySelectorAll('.request-type').forEach(div => {
                const checkbox = div.querySelector('input[type="checkbox"]');
                if (checkbox.checked) {
                    div.classList.add('selected');
                } else {
                    div.classList.remove('selected');
                }
            });
        }
        
        // Checkbox deÄŸiÅŸikliklerini dinle
        document.querySelectorAll('input[name="requestType"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateRequestTypeStyles);
        });
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // En az bir talep tipi seÃ§ilmiÅŸ mi kontrol et
            const selectedTypes = Array.from(document.querySelectorAll('input[name="requestType"]:checked'))
                .map(cb => cb.value);
            
            if (selectedTypes.length === 0) {
                showModal('error', 'Eksik Bilgi', 'LÃ¼tfen en az bir talep tipi seÃ§in.');
                return;
            }
            
            // Button'u disable et
            submitBtn.disabled = true;
            submitBtn.textContent = 'GÃ¶nderiliyor...';
            
            try {
                // Her talep tipi iÃ§in ayrÄ± istek gÃ¶nder
                const promises = selectedTypes.map(async (requestType) => {
                    // Her istek iÃ§in yeni reCAPTCHA token al
                    const recaptchaToken = await grecaptcha.execute(RECAPTCHA_SITE_KEY, { action: 'data_request' });
                    
                    const formData = {
                        requestType: requestType,
                        name: document.getElementById('name').value.trim(),
                        email: document.getElementById('email').value.trim(),
                        phone: document.getElementById('phone').value.trim() || null,
                        identityDocument: document.getElementById('identityDocument').value.trim() || null,
                        userId: document.getElementById('userId').value.trim() || null,
                        details: document.getElementById('details').value.trim(),
                        recaptchaToken: recaptchaToken
                    };
                    
                    const response = await fetch('https://europe-west3-dozi-cd7cc.cloudfunctions.net/submitDataRequest', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    return { requestType, response: await response.json(), status: response.status };
                });
                
                const results = await Promise.all(promises);
                
                // SonuÃ§larÄ± kontrol et
                const successful = results.filter(r => r.status === 200);
                const failed = results.filter(r => r.status !== 200);
                
                if (successful.length > 0) {
                    const typeLabels = {
                        access: 'Veri EriÅŸim',
                        correction: 'Veri DÃ¼zeltme',
                        deletion: 'Veri Silme',
                        portability: 'Veri TaÅŸÄ±nabilirlik',
                        objection: 'Ä°tiraz'
                    };
                    
                    const successTypes = successful.map(r => typeLabels[r.requestType]).join(', ');
                    
                    const bodyHtml = `
                        Talebiniz baÅŸarÄ±yla alÄ±ndÄ± ve iÅŸleme konuldu.
                        <strong>GÃ¶nderilen Talepler:</strong> ${successTypes}
                        <strong>Sonraki AdÄ±mlar:</strong>
                        â€¢ Email adresinize onay mesajÄ± gÃ¶nderildi
                        â€¢ Talebiniz en geÃ§ 30 gÃ¼n iÃ§inde yanÄ±tlanacak
                        â€¢ Talep numaranÄ±z email'inizde yer almaktadÄ±r
                    `;
                    
                    showModal('success', 'Talep GÃ¶nderildi', bodyHtml);
                    
                    // Formu temizle
                    form.reset();
                    updateRequestTypeStyles();
                }
                
                if (failed.length > 0) {
                    const failedTypes = failed.map(r => r.requestType).join(', ');
                    const errorMsg = failed[0].response.error || 'Bilinmeyen bir hata oluÅŸtu.';
                    
                    const bodyHtml = `
                        BazÄ± talepler gÃ¶nderilemedi: ${failedTypes}
                        <strong>Hata:</strong> ${errorMsg}
                        <strong>Ã‡Ã¶zÃ¼m:</strong>
                        â€¢ LÃ¼tfen birkaÃ§ dakika sonra tekrar deneyin
                        â€¢ Sorun devam ederse <a href="mailto:info@dozi.app" style="color: var(--dozi-turquoise);">info@dozi.app</a> adresine email gÃ¶nderin
                    `;
                    
                    showModal('error', 'GÃ¶nderim HatasÄ±', bodyHtml);
                }
                
            } catch (error) {
                console.error('Form gÃ¶nderme hatasÄ±:', error);
                
                const bodyHtml = `
                    Talep gÃ¶nderilirken bir hata oluÅŸtu.
                    <strong>Hata DetayÄ±:</strong> ${error.message}
                    <strong>Alternatif YÃ¶ntem:</strong>
                    LÃ¼tfen <a href="mailto:info@dozi.app" style="color: var(--dozi-turquoise);">info@dozi.app</a> adresine email gÃ¶ndererek talebinizi iletebilirsiniz.
                `;
                
                showModal('error', 'BaÄŸlantÄ± HatasÄ±', bodyHtml);
            } finally {
                // Button'u tekrar aktif et
                submitBtn.disabled = false;
                submitBtn.textContent = 'BaÅŸvuruyu GÃ¶nder';
            }
        });
    </script>
</body>
</html>
