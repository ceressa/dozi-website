<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.google.com https://www.gstatic.com; style-src 'self' 'unsafe-inline'; frame-src https://www.google.com; connect-src 'self' https://europe-west3-dozi-app.cloudfunctions.net;">
    
    <title>Hesap Silme Talebi | Dozi</title>
    <meta name="description" content="Dozi hesabÄ±nÄ±zÄ± silmek iÃ§in talep oluÅŸturun">
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="icon" type="image/png" href="dozi_brand.png">
    
    <!-- reCAPTCHA v3 -->
    <script src="https://www.google.com/recaptcha/api.js?render=6Lcp60MsAAAAAFZ4qhzifUXH7YRmVfhFu2n36epX"></script>
    
    <style>
        :root {
            --dozi-turquoise: #40E0D0;
            --dozi-dark: #0f172a;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --bg-light: #f8fafc;
            --danger: #ef4444;
            --success: #10b981;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-light); color: var(--text-primary); line-height: 1.6; }
        
        .container { max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        .header { text-align: center; margin-bottom: 2rem; }
        .header img { height: 48px; margin-bottom: 1rem; }
        .header h1 { font-size: 1.75rem; color: var(--dozi-dark); margin-bottom: 0.5rem; }
        .header p { color: var(--text-secondary); }
        
        .warning-box { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; }
        .warning-box strong { color: #92400e; }
        .warning-box ul { margin: 0.5rem 0 0 1.5rem; color: #92400e; }
        
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary); }
        .form-group label .required { color: var(--danger); }
        .form-group input, .form-group textarea { width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: var(--dozi-turquoise); }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-group small { display: block; margin-top: 0.25rem; color: var(--text-secondary); font-size: 0.875rem; }
        
        .btn { display: block; width: 100%; padding: 1rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-danger:hover:not(:disabled) { background: #dc2626; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .success-message, .error-message { padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: none; }
        .success-message { background: #d1fae5; color: #065f46; border-left: 4px solid var(--success); }
        .error-message { background: #fee2e2; color: #991b1b; border-left: 4px solid var(--danger); }
        .success-message.show, .error-message.show { display: block; }
        
        .back-link { text-align: center; margin-top: 1.5rem; }
        .back-link a { color: var(--dozi-turquoise); text-decoration: none; font-weight: 500; }
        .back-link a:hover { text-decoration: underline; }
        
        .recaptcha-notice { font-size: 0.75rem; color: var(--text-secondary); text-align: center; margin-top: 1rem; }
        
        @media (max-width: 640px) {
            .container { margin: 1rem auto; }
            .card { padding: 1.5rem; }
            .header h1 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <img src="dozi_brand.png" alt="Dozi">
                <h1>ğŸ—‘ï¸ Hesap Silme Talebi</h1>
                <p>HesabÄ±nÄ±zÄ± kalÄ±cÄ± olarak silmek iÃ§in formu doldurun</p>
            </div>
            
            <div class="warning-box">
                <strong>âš ï¸ Ã–nemli UyarÄ±:</strong>
                <ul>
                    <li>Bu iÅŸlem geri alÄ±namaz</li>
                    <li>TÃ¼m verileriniz kalÄ±cÄ± olarak silinecek</li>
                    <li>Premium aboneliÄŸiniz varsa Google Play'den iptal edin</li>
                    <li>Ä°ÅŸlem 7 iÅŸ gÃ¼nÃ¼ iÃ§inde tamamlanÄ±r</li>
                </ul>
            </div>
            
            <div id="successMessage" class="success-message"></div>
            <div id="errorMessage" class="error-message"></div>
            
            <form id="deletionForm">
                <div class="form-group">
                    <label>AdÄ±nÄ±z SoyadÄ±nÄ±z <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required maxlength="100">
                </div>
                
                <div class="form-group">
                    <label>Email Adresiniz <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required maxlength="100">
                    <small>Onay mesajÄ± bu adrese gÃ¶nderilecek</small>
                </div>
                
                <div class="form-group">
                    <label>KullanÄ±cÄ± ID (Opsiyonel)</label>
                    <input type="text" id="userId" name="userId" maxlength="50">
                    <small>Ayarlar > HakkÄ±nda > KullanÄ±cÄ± ID</small>
                </div>
                
                <div class="form-group">
                    <label>Silme Sebebi (Opsiyonel)</label>
                    <textarea id="reason" name="reason" maxlength="500" placeholder="HesabÄ±nÄ±zÄ± neden silmek istiyorsunuz?"></textarea>
                </div>
                
                <button type="submit" class="btn btn-danger" id="submitBtn">
                    Hesap Silme Talebini GÃ¶nder
                </button>
                
                <p class="recaptcha-notice">
                    Bu site reCAPTCHA ile korunmaktadÄ±r. Google <a href="https://policies.google.com/privacy" target="_blank">Gizlilik PolitikasÄ±</a> ve <a href="https://policies.google.com/terms" target="_blank">Hizmet ÅartlarÄ±</a> geÃ§erlidir.
                </p>
            </form>
            
            <div class="back-link">
                <a href="account-deletion.html">â† Geri DÃ¶n</a>
            </div>
        </div>
    </div>
    
    <script>
        const form = document.getElementById('deletionForm');
        const submitBtn = document.getElementById('submitBtn');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        
        // reCAPTCHA site key
        const RECAPTCHA_SITE_KEY = '6Lcp60MsAAAAAFZ4qhzifUXH7YRmVfhFu2n36epX';
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // MesajlarÄ± temizle
            successMessage.classList.remove('show');
            errorMessage.classList.remove('show');
            
            // Button'u disable et
            submitBtn.disabled = true;
            submitBtn.textContent = 'GÃ¶nderiliyor...';
            
            try {
                // reCAPTCHA token al
                const recaptchaToken = await grecaptcha.execute(RECAPTCHA_SITE_KEY, { action: 'account_deletion' });
                
                // Form verilerini topla
                const formData = {
                    name: document.getElementById('name').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    userId: document.getElementById('userId').value.trim() || null,
                    reason: document.getElementById('reason').value.trim() || null,
                    recaptchaToken: recaptchaToken
                };
                
                // Firebase Function'a gÃ¶nder
                const response = await fetch('https://europe-west3-dozi-app.cloudfunctions.net/submitAccountDeletionRequest', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    // BaÅŸarÄ±lÄ±
                    successMessage.textContent = `âœ… ${data.message} Talep numaranÄ±z: ${data.requestId}`;
                    successMessage.classList.add('show');
                    form.reset();
                    
                    // 3 saniye sonra yÃ¶nlendir
                    setTimeout(() => {
                        window.location.href = 'account-deletion.html';
                    }, 3000);
                } else {
                    // Hata
                    errorMessage.textContent = `âŒ ${data.error || 'Bir hata oluÅŸtu'}`;
                    errorMessage.classList.add('show');
                }
            } catch (error) {
                console.error('Form gÃ¶nderme hatasÄ±:', error);
                errorMessage.textContent = 'âŒ BaÄŸlantÄ± hatasÄ±. LÃ¼tfen tekrar deneyin.';
                errorMessage.classList.add('show');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Hesap Silme Talebini GÃ¶nder';
            }
        });
    </script>
</body>
</html>
